# 实时视频会议功能 - 验证清单

## 数据库与后端 API 验证

- [ ] **Checkpoint 1**: 数据库表结构正确
  - meetings 表包含所有必要字段（id, title, creator_name, chat_type, chat_id, start_time, end_time, status, created_at）
  - meeting_participants 表正确关联 meetings 和 users
  - meeting_chat_messages 表正确关联 meetings 和 users，包含发送时间字段用于30天清理
  - meeting_recordings 表包含录制文件信息（id, meeting_id, file_path, duration, file_size, created_at）
  - 外键约束和索引正确设置
  - 定时任务配置正确，可清理超过30天的聊天记录

- [ ] **Checkpoint 2**: 会议管理 API 正常工作
  - POST /create_meeting 成功创建会议并返回会议ID
  - GET /meetings 返回当前用户相关的所有会议
  - GET /meeting/<id> 返回指定会议的详细信息
  - POST /update_meeting_status 正确更新会议状态（验证权限）
  - POST /end_meeting 正确结束会议并通知所有参与者
  - GET /meeting_history 返回用户的历史会议列表（包含已结束会议）

- [ ] **Checkpoint 3**: 会议参与者管理 API 正常工作
  - POST /join_meeting 验证会议状态和时间后允许加入
  - POST /leave_meeting 正确处理用户离开
  - GET /meeting_participants/<id> 返回参会者列表和状态
  - POST /control_participant 验证管理员权限后转发控制命令

- [ ] **Checkpoint 4**: 会议录制 API 正常工作
  - POST /start_recording 验证管理员权限后开始录制
  - POST /stop_recording 停止录制并保存文件信息
  - GET /meeting_recordings/<meeting_id> 返回会议录制列表
  - GET /playback/<recording_id> 正确返回视频流或下载链接
  - 录制文件正确保存到服务器指定目录

- [ ] **Checkpoint 5**: Socket.IO 信令服务器正常工作
  - WebRTC 信令事件（offer, answer, ice-candidate）正确转发
  - 会议房间管理（join_meeting_room, leave_meeting_room）正常工作
  - 参会者状态变化实时广播给房间内所有用户
  - 管理员控制命令正确转发给目标用户
  - 举手状态变化实时同步给所有参会者
  - 会议聊天消息实时广播给房间内所有用户
  - 屏幕共享信令（screen_share_start, screen_share_stop）正确转发

## 前端 UI 验证

- [ ] **Checkpoint 6**: "+"按钮和会议预约模态框
  - 聊天界面右上角显示"+"下拉菜单按钮
  - 点击"+"显示包含"视频会议"选项的菜单
  - 点击"视频会议"弹出预约模态框
  - 模态框包含会议标题输入、开始/结束时间选择器
  - 结束时间超过开始时间2小时显示错误提示
  - 提交表单调用正确的API并关闭模态框

- [ ] **Checkpoint 7**: 会议卡片显示
  - 会议卡片在聊天消息列表中正确显示
  - 卡片显示会议标题、开始时间、状态
  - 会议开始前10分钟"加入"按钮变为可用
  - 已结束会议显示正确状态且无法加入
  - 点击"加入"按钮跳转到会议页面

- [ ] **Checkpoint 8**: 视频会议主界面（桌面端）
  - 会议页面正确加载并显示本地视频预览
  - 视频网格布局自适应参会人数（1-20人）
  - 每个视频画面显示用户名和状态图标
  - 远程视频流正确接收并显示
  - 界面响应式，适配桌面设备

- [ ] **Checkpoint 9**: 视频会议主界面（移动端）
  - 移动端竖屏布局正确显示
  - 视频网格可滑动查看所有参会者
  - 控制栏简化并适配触摸操作
  - 聊天窗口采用底部弹出式设计
  - 参会者列表采用抽屉式设计
  - 按钮大小适合触摸操作

- [ ] **Checkpoint 10**: 媒体控制功能
  - 底部控制栏包含麦克风、摄像头、屏幕共享、录制（管理员）、举手、聊天、全屏、退出按钮
  - 点击麦克风按钮切换音频轨道启用状态
  - 点击摄像头按钮切换视频轨道启用状态
  - 状态变化通过 Socket.IO 同步给其他参会者
  - 按钮图标正确反映当前状态

- [ ] **Checkpoint 11**: WebRTC 连接管理
  - 新用户加入时正确创建 RTCPeerConnection
  - SDP offer/answer 交换成功建立连接
  - ICE candidate 交换成功
  - 用户离开时清理对应连接
  - 音视频数据正常传输

- [ ] **Checkpoint 12**: 屏幕共享功能
  - 点击屏幕共享按钮成功获取屏幕流
  - 屏幕共享视频在网格中突出显示
  - 其他参会者可以看到共享的屏幕
  - 点击停止共享后恢复正常视频
  - 同一时间只有一人可以共享屏幕

- [ ] **Checkpoint 13**: 录制与回放功能
  - 录制按钮仅管理员可见
  - 点击开始录制后显示红色录制指示灯
  - 录制文件正确保存到服务器
  - 历史会议列表显示录制状态
  - 回放页面可以播放录制视频
  - 回放时同步显示聊天记录
  - 视频播放器包含播放、暂停、进度条、倍速控件

- [ ] **Checkpoint 14**: 管理员控制功能
  - 会议创建者自动成为管理员
  - 管理员看到参会者列表和控制按钮
  - 管理员可以关闭指定参会者的摄像头
  - 管理员可以关闭指定参会者的麦克风
  - 管理员可以提前结束会议
  - 管理员可以打开/关闭会议聊天窗口
  - 管理员可以开始/停止会议录制

- [ ] **Checkpoint 15**: 举手和全屏功能
  - 点击举手按钮切换举手状态
  - 举手状态在视频画面上显示图标
  - 举手状态实时同步给所有参会者
  - 点击全屏按钮切换到全屏模式
  - 全屏模式下视频布局正确适配
  - 按 ESC 键退出全屏

- [ ] **Checkpoint 16**: 会议聊天功能（持久化）
  - 会议聊天侧边栏/浮动窗口正常显示
  - 可以输入和发送文本消息
  - 消息列表正确显示所有消息
  - 系统消息（用户加入/离开、举手）正确显示
  - 聊天窗口可以打开/关闭
  - 新消息自动滚动到底部
  - 消息保存到数据库，保留30天
  - 历史聊天记录可正确加载

- [ ] **Checkpoint 17**: 会议列表与历史记录页面
  - 从"+"菜单可以进入"所有视频会议"页面
  - 列表显示所有可加入的会议（待开始/进行中）
  - 显示历史会议列表（已结束）
  - 历史会议显示录制状态和回放按钮
  - 历史会议显示聊天记录查看按钮
  - 会议按开始时间排序
  - 不同状态的会议有视觉区分

- [ ] **Checkpoint 18**: 会议状态自动更新
  - 到达开始时间会议状态自动变为 active
  - 到达结束时间会议状态自动变为 ended
  - 状态变化通知发送到客户端
  - UI 根据状态变化自动更新

## 错误处理和用户体验

- [ ] **Checkpoint 19**: 权限和错误处理
  - 摄像头/麦克风权限被拒绝时显示友好的提示
  - 设备不可用时提供降级方案（仅音频）
  - 网络断开时显示连接状态提示
  - 提供重新连接机制
  - 所有错误提示使用中文且易于理解

- [ ] **Checkpoint 20**: 移动端适配
  - 移动端视频布局正确
  - 触摸操作流畅，按钮大小合适
  - 移动端权限请求处理正确
  - 响应式设计在不同屏幕尺寸下正常显示
  - 移动端手势操作正常（滑动、点击）

## 集成测试

- [ ] **Checkpoint 21**: 端到端功能测试
  - 完整流程：创建会议 -> 显示卡片 -> 加入会议 -> 音视频通话 -> 结束会议
  - 多人会议（3人以上）音视频质量可接受
  - 管理员控制功能在多人场景下正常工作
  - 会议状态转换（scheduled -> active -> ended）正确
  - 页面刷新后会议状态正确恢复
  - 屏幕共享功能在多人场景下正常
  - 录制功能完整工作（开始->录制->停止->回放）

- [ ] **Checkpoint 22**: 性能测试
  - 视频延迟不超过 500ms
  - 支持最多 20 人同时参会
  - 页面加载时间不超过 3 秒
  - 内存使用稳定，无内存泄漏
  - 屏幕共享帧率稳定（不低于15fps）

## 安全验证

- [ ] **Checkpoint 23**: 权限验证
  - 只有聊天参与者可以创建对应会议
  - 只有会议参与者可以加入会议
  - 只有管理员可以执行管理操作
  - 只有管理员可以开始/停止录制
  - API 接口正确验证用户身份和权限

- [ ] **Checkpoint 24**: 数据安全
  - WebRTC 连接使用加密传输
  - 敏感数据（如用户ID）不在前端暴露
  - 会议数据正确存储和访问控制
  - 录制文件访问需要正确权限验证
  - 聊天记录只能被会议参与者访问
